{% extends 'base.html.twig' %}

{% block title 'Nos Offres' %}

{% block body %}

    <div class="jumbotron text-center">
        <h1>Nos Offres</h1>
        <h2>Les Offres toujours d'actualités</h2>
        <div class="row flex">
            {% for offre in offres %}
                <div class="col-3" style="margin-bottom: 50px;">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">
                                <a href="#"> {{ offre.title }}</a>
                            </h5>
                            <p class="card-text" align="justify" style="text-overflow: ellipsis;
                           overflow: hidden; display: -webkit-box; -webkit-line-clamp:6;-webkit-box-orient: vertical;
                            ">{{ offre.content }} </p>
                            <div class="text-primary">{{ offre.createdAt|date('d/m/Y') }}</div>
                            <button id="BtnInfo{{ loop.index }}" class="btn btn-success">Lire plus</button>
                            <div id="OfferModal{{ loop.index }}" class="modal" style="
                        display: none;
                        position: fixed;
                        z-index: 1;
                        left: 0;
                        top: 0;
                        width: 100%;
                        height: 100%;
                        overflow: auto;
                        background-color: rgb(0,0,0);
                        background-color: rgba(0,0,0,0.4);">
                                <div class="modal-content" style="
                              top: -200px;
                              background-color: #fefefe;
                              margin: 15% auto; /* 15% from the top and centered */
                              padding: 20px;
                              border: 1px solid #888;
                              width: 80%; /* Could be more or less, depending on screen size */">
                                    <h1> {{ offre.title }}</h1>
                                    <div class="card" style="min-height: auto;text-align: justify">{{ offre.content}}</div>
                                    <br/>
                                    <p align="left"> Du :{{ offre.beginAt | date('d/m/Y')}} au :{{ offre.endAt | date('d/m/Y') }}</p>
                                    <p align="left">Offre d'emploi créé le :{{ offre.createdAt | date('d/m/Y') }}</p>
                                    <button id="BtnCandidate{{ loop.index }}" style="width: 100px;">Postuler</button>
                                </div>
                            </div>


                        </div>
                    </div>
                </div>

            {% endfor %}
            <div id="CandidateModal" class="modal" style="
                        display: none;
                        position: fixed;
                        z-index: 1;
                        left: 0;
                        top: 0;
                        width: 100%;
                        height: 100%;
                        overflow: auto;
                        background-color: rgb(0,0,0);
                        background-color: rgba(0,0,0,0.4);">
                <div class="modal-content" style="
                                background-color: #fefefe;
                              margin: 15% auto; /* 15% from the top and centered */
                              padding: 20px;
                              border: 1px solid #888;
                              width: 80%; /* Could be more or less, depending on screen size */">
                    <h2 id="CandidateTitle"> Remplissez le formulaire pour l'offre !</h2>
                    {{ form_start(CandidateForm) }}
                    {{ form_end(CandidateForm) }}
                    <button type="submit" class="btn btn-primary">Postuler</button>
                    <p id="id"><small></small></p>
                </div>
            </div>

        </div>
        <div id="map" style="height: 400px; width: 400px;margin: 0 auto"></div>

        <script async defer
                src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCw1ekYuDesZlOCLckgm8uZ9WH96ZtXQsA&callback=initMap">
        </script>
    </div>

{% endblock %}

 {% block javascripts %}
     <script>

         window.onload = function initMap() {
             // The location of Uluru
             var uluru = {lat: 48.144679, lng: -0.117047};
             // The map, centered at Uluru
             var map = new google.maps.Map(
                 document.getElementById('map'), {zoom: 11, center: uluru});
             // The marker, positioned at Uluru
             var marker = new google.maps.Marker({position: uluru, map: map, title: "ABC Legermain"});
         };

         var modalCandidate = document.getElementById("CandidateModal");
         {% for offre in offres %}

         var modal{{ loop.index }} = document.getElementById("OfferModal{{ loop.index }}");
         var btn{{ loop.index }} = document.getElementById("BtnInfo{{ loop.index }}");
         var btnCandidate{{ loop.index }} = document.getElementById("BtnCandidate{{ loop.index }}");
         var openModal;

         btn{{ loop.index }}.onclick = function () {
            openModal = modal{{ loop.index }};
            modal{{ loop.index }}.style.display = "block";
         };


         btnCandidate{{ loop.index }}.onclick = function () {
             modal{{ loop.index }}.style.display = "none";
             modalCandidate.style.display = "block";
             document.getElementById("CandidateTitle").innerHTML="Remplissez le formulaire pour l'offre {{ offre.id }} !";
         };

         window.onclick = function(event) {
             if (event.target === openModal) {
                 openModal.style.display = "none";
             }
             if(event.target === modalCandidate) {
                 modalCandidate.style.display = "none";
             }
         };



         {% endfor %}

     </script>
 {% endblock %}
